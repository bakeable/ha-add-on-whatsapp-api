# WhatsApp API Home Assistant Add-on Configuration
name: WhatsApp API
slug: whatsapp_api
description: WhatsApp controller API (based on Evolution API) as a Home Assistant add-on. Connect WhatsApp to your smart home automations.
version: "2.3.7"
url: https://github.com/bakeable/ha-add-on-whatsapp-api

# Supported architectures
arch:
  - aarch64
  - armv7
  - amd64
  
# Add-on behavior
startup: services
boot: auto
init: false

# Network configuration
# The gateway UI (ingress) runs on port 8099
ingress: true
ingress_port: 8099
panel_icon: mdi:whatsapp
panel_title: WhatsApp
ports:
  8080/tcp: 8080
  8099/tcp: 8099
ports_description:
  8080/tcp: Evolution API REST API (internal)
  8099/tcp: WhatsApp Gateway UI

# Storage mappings - persistent data for sessions
map:
  - addon_config:rw

# User-configurable options
options:
  api_key: ""
  instance_name: "Home"
  webhook_url: ""
  log_level: "INFO"
  database_provider: "mysql"
  database_host: "core-mariadb"
  database_port: 3306
  database_name: "evolution"
  database_user: "evolution"
  database_password: ""
  redis_uri: ""
  # Instance settings
  sync_full_history: true
  reject_calls: false
  groups_ignore: false
  always_online: false
  read_messages: false
  read_status: false
  # Gateway settings
  allowed_services: "script.turn_on,automation.trigger"

# Schema for options validation
schema:
  api_key: str?
  instance_name: str
  webhook_url: url?
  log_level: list(DEBUG|INFO|WARN|ERROR)
  database_provider: list(mysql|postgresql)
  database_host: str
  database_port: int
  database_name: str
  database_user: str
  database_password: password
  redis_uri: str?
  # Instance settings
  sync_full_history: bool
  reject_calls: bool
  groups_ignore: bool
  always_online: bool
  read_messages: bool
  read_status: bool
  # Gateway settings
  allowed_services: str

# Watchdog for auto-restart on failure
watchdog: http://[HOST]:[PORT:8080]/

# API access
homeassistant_api: true
hassio_api: true
